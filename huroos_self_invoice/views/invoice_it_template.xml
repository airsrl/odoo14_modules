<?xml version="1.0" encoding="utf-8" ?>
<!-- Copyright Huroos Srl -->
<odoo>

    <template id="account_invoice_it_FatturaPA_export"  inherit_id="l10n_it_fatturapa_out.account_invoice_it_FatturaPA_export" >
        <xpath expr="//t[@t-call='l10n_it_fatturapa_out.account_invoice_it_cedente_prestatore']" position="replace">
            <t t-call="l10n_it_fatturapa_out.account_invoice_it_cedente_prestatore">
                <!--Per l'autofattura se è valorizzato il campo rc_purchase_invoice_id il CEDENTE PRESTATORE è IL FORNITORE-->
                <t t-set="partner_id" t-value="company_id.partner_id" />
                <t t-set="integration_supplier" t-value="invoices.mapped('po_integration_invoice_id.partner_id')" />
                <t t-if="integration_supplier">
                    <t t-set="partner_id" t-value="integration_supplier" />
                    <t t-set="company_id" t-value="" />
                </t>
                <!--Devo ricopiare questo blocco aggiunto dal modulo reverse charge out-->
                <t t-set="rc_supplier" t-value="invoices.mapped('rc_purchase_invoice_id.partner_id')"/>
                <t t-if="rc_supplier">
                    <t t-set="partner_id" t-value="rc_supplier" />
                    <t t-set="company_id" t-value="" />
                </t>
            </t>
        </xpath>
        <!--Mette CC se la fattura è un TD20 integrazione per servizi-->
        <xpath expr="//SoggettoEmittente" position="replace">
            <t t-set="soggetto_emittente_code" t-value="invoices.mapped('fiscal_document_type_id.code')" />
            <SoggettoEmittente t-if="not invoices.po_integration_invoice_id">TZ</SoggettoEmittente>
            <SoggettoEmittente t-if="'TD20' in soggetto_emittente_code and invoices.po_integration_invoice_id">CC</SoggettoEmittente>
        </xpath>

    </template>


</odoo>
